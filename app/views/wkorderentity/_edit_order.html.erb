<%= stylesheet_link_tag 'wk-time', :plugin => "redmine_wktime" %>
<%= javascript_include_tag 'invoice', :plugin => "redmine_wktime" %>
<% hash_status = { 'o'  => l(:label_open_issues), 'c' =>  l(:label_closed_issues) } %>
<%= form_tag({:controller => controller_name, :action => 'update'}, :method => :post, :id => 'query_form') do %>
	<%=h hidden_field_tag("parent_id",  @invoice.parent_id )  %>
	<%=h hidden_field_tag("parent_type",  @invoice.parent_type )  %>
	<%=h hidden_field_tag("inv_end_date",  @invoice.end_date )  %>
	<%=h hidden_field_tag("inv_start_date",  @invoice.start_date )  %>
	<%=h hidden_field_tag("invoice_type",  controller.getInvoiceType )  %>
	<table>
		<tr><th align="left"><%= controller.getLabelInvNum %></th> 
			<td style="width: 200px;"> 
				<%= ": " %>
				<% if !@invoice.blank? %>
					<% if @invoice.invoice_number.blank? && controller.getInvoiceType == 'I' %>
						<span style="color:Purple;"><b><%= l(:label_unbilled) %></b></span>
					<% else %>
						<%= @invoice.invoice_number %>
					<% end %>
				
				<% end %> 
			</td>
			<th align="left"><%= controller.getDateLbl %></th>
			<td style="width: 200px;"><%= ": "%> <%=h date_field_tag('inv_date', (@invoice.blank? ? Date.today.to_s : @invoice.invoice_date.to_s), :size => 10, :required => true, :disabled => @preBilling) %> <%= calendar_for('inv_date') %></td>
			
			<th align="left" style="width:20px;"><%= l(:field_status) %></th> 
			<td><%= ": "%>
			<%=h select_tag('field_status',options_for_select(hash_status.invert, :selected => @invoice.blank? ? hash_status.invert : @invoice.status ), :disabled => @preBilling) %>  </td>
			
		</tr>
		<%# projectName = (@invoiceItem.blank? ? (@projectsDD.blank? ? '' : @projectsDD[0][0].to_s) : @invoiceItem[0].project.name)   %>
		<tr>
		<!--	<th align="left"><%#= l(:label_project_name) %></th> 
			<td style="width: 200px;"> <%#= ': ' + projectName  %> </td> -->
			
			<th align="left"><%= l(:label_account) %></th> 
			<td style="width: 200px;"> <%= ': ' + (@invoice.blank? ? '' : @invoice.parent.name) %> </td>
			
			<th align="left" style="width:80px;"><%= l(:field_status_modified_by) %></th> 
			<td> <%= ': ' + (@invoice.blank? ? User.current.to_s : @invoice.modifier.name) %> </td>
			
		</tr>
		<% if controller.getInvoiceType == 'Q' %>
			<tr>
				<th align="left"><%= l(:label_rfq_name) %></th> 
				<td style="width: 200px;"> <%= ': ' + (@rfqObj.blank? ? '' : @rfqObj.name) %> </td>
				
				<th align="left" ><%= l(:label_won_note) %></th>
				<td rowspan= "2" colspan="8" align="left" ><%= text_area_tag 'won_note', "", :maxlength => 255, :style => "width:605px; height:80px;" %></td>
			</tr>
			<tr>
				<th align="left"><label><%= l(:label_won) %></label></th>
				<td><%= check_box_tag('quote_won', 0 ) %></td>	
						
				
			</tr>
		<% end %>
	</table>
	
	<% if !@invoiceItem.blank? %>
		<% if !@invoiceItem[0].blank? %>
			<%= render :partial => 'edit_order_items' %>
		<% end %>
	<% else %>
		<% if !@invoice.blank?  %>
			<%= render :partial => 'edit_order_items' %>
		<% else  %>
			<br/>
			<h2 ><%= @moduleType == 'i' ? l(:label_invoice_items) : (@moduleType == 'q' ? l(:label_quote_items)  : l(:label_po_items) )  %></h2> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<label><b><%= l(:label_no_data) %></b></label>
		<% end %>
	<% end %>
<% end %>