<%= javascript_include_tag 'survey', :plugin => "redmine_wktime" %>
<%= stylesheet_link_tag 'wk-time', :plugin => "redmine_wktime" %>

<% 	if @edit_Question_Entries.blank?
		survey_name = nil
		status = nil
		inActive = nil
		survey_id = nil
	else
		survey_id = @edit_Question_Entries.first.id
		survey_name = @edit_Question_Entries.first.survey_name
		status = @edit_Question_Entries.first.status
		inActive = @edit_Question_Entries.first.in_active
	end 
%>
<% if @edit_Question_Entries.blank?%>
<h2><%= l(:label_new_survey) %></h2>
<% else %>
<h2><%= l(:label_edit_survey) %></h2>
<% end %>


<div class="autoscroll">
<%= form_tag({:controller => 'wksurvey', :action => 'save_survey'}, :method => :post, :id => 'query_form') do %>
	<%=h hidden_field_tag('survey_id', survey_id) %>

	<fieldset>
	<table>
		<tr>
		<th align="left"><%= l(:label_survey_name) %></th>
		<td align="left" style="padding-left:40px;">
			<%=h text_field_tag("survey_name", survey_name, :size => 40) %>
		</td>
        <tr>
            <th align="left"><%= l(:label_status) %></th>
            <td align="left" style="padding-left:40px;">
                <%=h select_tag("survey_status", options_for_select(getSurveyStatusArr.drop(1), status)) %>
            </td>
        </tr>
	<% unless @edit_Question_Entries.blank? %>
        <tr>
            <th align="left"><%= l(:label_inactive) %></th>
            <td align="left" style="padding-left:40px;">
                <%=h check_box_tag("survey_inactive", true, inActive ) %>
            </td>
        </tr>
	<% end %>
	</table>
	</fieldset>
    
	<div id="accordion">
		<h2><%= l(:label_survey_questions) %></h2>
		<div id="questionsection">
		<% unless @edit_Question_Entries.blank? %>
			<% @edit_Question_Entries.each_with_index do |question, qIndex| %>
			<fieldset class="surveyquestions">
				<table id="newsurvey" class="odd-even" align='left'>
					<tr>
						<th align="left"><%= l(:label_question_name) %></th>
						<td align="left" style="padding-left:40px;">
							<%=h text_field_tag("questionName_" + qIndex.to_s + "_" + (question.question_id).to_s, question.question_name, :size => 40) %>
						</td>
					</tr>
					<% 
					firstchoice = true;
					@edit_Choice_Entries.each_with_index do |choice, cIndex| 
					if choice.question_id == question.question_id
					%>
						<tr>
							<% 
							if firstchoice
							firstchoice = false
							%>
								<th align="left"><%= l(:label_question_choices) %></th>
								<td align="left" style="padding-left:40px;">
									<%=h text_field_tag(("surveyChoices_" + cIndex.to_s + "_" + (question.question_id).to_s + "_" +(choice.choice_id).to_s), choice.name, :size => 40) %>
								</td>
							<% else %>
								<td></td>
								<td align="left" style="padding-left:40px;">
									<%=h text_field_tag(("surveyChoices_" + cIndex.to_s + "_" + (question.question_id).to_s + "_" +(choice.choice_id).to_s), choice.name, :size => 40) %>
									<%=link_to image_tag('delete.png'), "javascript:deleterow(" + cIndex.to_s + ");", :title => l(:button_delete) %>
								</td>
							<% end %>
						</tr>
					<% end
					end %>
							
					<tr id="lastrow">
						<td></td>
						<td align="right" style="padding-left:40px;">
							<%= link_to l(:button_add), "#", { :onclick => "javascript:addrows(" + qIndex.to_s + ");", :class => 'icon icon-add' } %>
						</td>
					</tr>
				</table>
			</fieldset>
			<% end %>
		<% end %>
			<div id="add_link" class="wk-contextual">
				<%= link_to l(:button_add_question), "#", { :onclick => "javascript:addquestion();", :class => 'icon icon-add' } %>
			</div>
		</div>
	</div>

	<div>
		<%= submit_tag l(:button_save), :id => 'wksurvey_save' %>
	</div>
<% end %>
<div id="add_question_template" style="display:none">
	<fieldset class="surveyquestions">
	<table id="questiontable_QID">
		<tr>
			<th align="left"><%= l(:label_question_name) %></th>
			<td align="left" style="padding-left:40px;">
				<%=h text_field_tag("questionName_QID_", "", :size => 40) %>
			</td>
		</tr>
		<tr>
			<th align="left"><%= l(:label_question_choices) %></th>
			<td align="left" style="padding-left:40px;">
				<%=h text_field_tag("surveyChoices_QID_0_", "", :size => 40) %>
			</td>
		</tr>
		<tr id="lastrow_QID">
			<td></td>
			<td align="right" style="padding-left:40px;">
				<%= link_to l(:button_add), "#", { :onclick => "javascript:addrows(QID);", :class => 'icon icon-add' } %>
			</td>
		</tr>
	</table>
	</fieldset>
</div>
</div>