<div class="survey-graph" >
	<canvas id="choices_selected_by_user<%= entry.id %>" width="350" height="200"></canvas>
</div>

<%= javascript_tag do %>
$(document).ready(function(){
  $.getJSON(<%= raw url_for(:controller => 'wksurvey',
    :action => 'graph',
	:graph => "choices_selected_by_user",
	:survey_id => entry.id).to_json %>, function(data){
	
    var chartData = {
      labels: data['labels'],
      datasets: [{
        label: <%= raw l(:label_no_of_users).to_json %>,
        backgroundColor: 'rgba(153, 102, 255, 1)',
        borderColor: 'rgb(153, 102, 255, 1)',
        borderWidth: 3,
        data: data['choices']
      }]
    };
	
		Chart.pluginService.register({
			beforeRender: function (chart) {
				if (chart.config.options.showAllTooltips) {
					// create an array of tooltips
					// we can't use the chart tooltip because there is only one tooltip per chart
					chart.pluginTooltips = [];
					chart.config.data.datasets.forEach(function (dataset, i) {
						chart.getDatasetMeta(i).data.forEach(function (sector, j) {
							chart.pluginTooltips.push(new Chart.Tooltip({
								_chart: chart.chart,
								_chartInstance: chart,
								_data: chart.data,
								_options: chart.options.tooltips,
								_active: [sector]
							}, chart));
						});
					});

					// turn off normal tooltips
					chart.options.tooltips.enabled = false;
				}
			}
			});
	
	
	
    new Chart(document.getElementById("choices_selected_by_user<%= entry.id %>").getContext("2d"), {
      type: 'horizontalBar',
      data: chartData,
      options: {
	  showAllTooltips: true,
       scales:  {
            xAxes: [{ 
			ticks: {
                display: false
            },
			gridLines : {
					drawBorder: false,
                    display : false
                }
            }],
			yAxes: [{   
			barThickness : 20,
			gridLines : {
			drawBorder: true,
                    display : false
                }
            }]	
        },
        responsive: false,
		maintainAspectRatio: false,
        legend: {position: 'right'}
      }
    });
  });
  });
<% end %>


<% content_for :header_tags do %>
  <%= javascript_include_tag "Chart.bundle.min" %>
<% end %>