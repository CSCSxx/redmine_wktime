 Profit and loss per month:
  chart_type: Line
  code_str: "incomeDetail = WkGlTransactionDetail.joins('LEFT OUTER JOIN wk_ledgers on wk_ledgers.id = wk_gl_transaction_details.ledger_id').joins('LEFT OUTER JOIN wk_gl_transactions on wk_gl_transactions.id = wk_gl_transaction_details.gl_transaction_id' ).where('wk_ledgers.ledger_type IN (?) and wk_gl_transactions.trans_date between ? and ?', incomeLedgerTypes, (@to - 12.months + 1.days), @to).select('SUM(wk_gl_transaction_details.amount) AS sum_amount, wk_ledgers.id as ledger_id, wk_ledgers.ledger_type, wk_gl_transaction_details.detail_type, extract(year from wk_gl_transactions.trans_date) AS trans_year, extract(month from wk_gl_transactions.trans_date) AS trans_month ').group('wk_ledgers.id, wk_ledgers.ledger_type, wk_gl_transaction_details.detail_type, extract(year from wk_gl_transactions.trans_date), extract(month from wk_gl_transactions.trans_date)'); incomeHash = Hash.new; incomeDetail.each do |ic|; transDt = (ic.trans_year.to_i.to_s + (ic.trans_month.to_i.to_s.length == 1 ? '0' : '') + ic.trans_month.to_i.to_s).to_i; if incomeHash[transDt].blank?; incomeHash[transDt] = {ic.ledger_type => {ic.detail_type => ic.sum_amount}}; else; if incomeHash[transDt][ic.ledger_type].blank?; incomeHash[transDt][ic.ledger_type] = {ic.detail_type => ic.sum_amount}; else; if incomeHash[transDt][ic.ledger_type][ic.detail_type].blank?; incomeHash[transDt][ic.ledger_type][ic.detail_type] = ic.sum_amount; else; incomeHash[transDt][ic.ledger_type][ic.detail_type] += ic.sum_amount; end				; end			; end; end; profitIncomeHash = Hash.new; incomeHash.each do |yearMon, ledTypeHash|; ledTypeHash.each do |ledgerType, trxAmountHash|; profitValHash = calculateBalance({ledgerType=> trxAmountHash['c'].to_f}, {ledgerType=> trxAmountHash['d'].to_f}, ledgerType); unless profitIncomeHash[yearMon].blank?; profitIncomeHash[yearMon] += profitValHash[ledgerType].to_f; else; profitIncomeHash[yearMon] = profitValHash[ledgerType].to_f; end; end; end; fields = []; 12.times {|m| fields << month_name(((@to.month - 1 - m) % 12) + 1).first(3)}; @profit_income_arr = [0]*12; profitIncomeHash.each {|month, sum| @profit_income_arr[@to.month - month.to_i] = sum }; expenseDetail = WkGlTransactionDetail.joins('LEFT OUTER JOIN wk_ledgers on wk_ledgers.id = wk_gl_transaction_details.ledger_id').joins('LEFT OUTER JOIN wk_gl_transactions on wk_gl_transactions.id = wk_gl_transaction_details.gl_transaction_id' ).where('wk_ledgers.ledger_type IN (?) and wk_gl_transactions.trans_date between ? and ?', expenseLedgerTypes, (@to - 12.months + 1.days), @to).select('SUM(wk_gl_transaction_details.amount) AS sum_amount, wk_ledgers.id as ledger_id, wk_ledgers.ledger_type, wk_gl_transaction_details.detail_type, extract(year from wk_gl_transactions.trans_date) AS trans_year, extract(month from wk_gl_transactions.trans_date) AS trans_month ').group('wk_ledgers.id, wk_ledgers.ledger_type, wk_gl_transaction_details.detail_type, extract(year from wk_gl_transactions.trans_date), extract(month from wk_gl_transactions.trans_date)'); expenseHash = Hash.new; expenseDetail.each do |ic|; transDt = (ic.trans_year.to_i.to_s + (ic.trans_month.to_i.to_s.length == 1 ? '0' : '') + ic.trans_month.to_i.to_s).to_i; if expenseHash[transDt].blank?; expenseHash[transDt] = {ic.ledger_type => {ic.detail_type => ic.sum_amount}}; else; if expenseHash[transDt][ic.ledger_type].blank?; expenseHash[transDt][ic.ledger_type] = {ic.detail_type => ic.sum_amount}; else; if expenseHash[transDt][ic.ledger_type][ic.detail_type].blank?; expenseHash[transDt][ic.ledger_type][ic.detail_type] = ic.sum_amount; else; expenseHash[transDt][ic.ledger_type][ic.detail_type] += ic.sum_amount; end				; end			; end; end; profitExpenseHash = Hash.new; expenseHash.each do |yearMon, ledTypeHash|; ledTypeHash.each do |ledgerType, trxAmountHash|; profitValHash = calculateBalance({ledgerType=> trxAmountHash['c'].to_f}, {ledgerType=> trxAmountHash['d'].to_f}, ledgerType); unless profitExpenseHash[yearMon].blank?; profitExpenseHash[yearMon] += profitValHash[ledgerType].to_f; else; profitExpenseHash[yearMon] = profitValHash[ledgerType].to_f; end; end; end; yearMonthArr = profitExpenseHash.keys.sort; fields = []; 12.times {|m| fields << month_name(((@to.month - 1 - m) % 12) + 1).first(3)} ; @profit_expense_arr = [0]*12; last_year = @from.year; last_month = @from.month; last_total = 0; yearMonthArr.each do |yearMon|; year = yearMon.to_s.first(4).to_i; month = yearMon.to_s.last(2).to_i; while last_month != month && ((last_month + 1) % 12 != month); @profit_expense_arr[@to.month - ((last_month + 1) % 12)] = last_total; last_year += 1; last_month += 1; end; @profit_expense_arr[@to.month - yearMon.to_s.last(2).to_i] = profitExpenseHash[yearMon]; last_year = year; last_month = month; last_total = profitExpenseHash[yearMon]; end;{ 'fields' => fields.reverse };"
  x_title: "label_months"
  y_title: "label_amount"
  names_of_data:
   - data: "@profit_income_arr.reverse"
     title: "label_total_income"
   - data: "@profit_expense_arr"
     title: "label_total_expense" 